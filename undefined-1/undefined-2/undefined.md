---
description: ê°€ìƒê³„ì¢Œ ì…ê¸ˆë‚´ì—­ì„ í™˜ë¶ˆí•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•©ë‹ˆë‹¤.
---

# ğŸ’· ê°€ìƒê³„ì¢Œ í™˜ë¶ˆí•˜ê¸°

### ê°€ìƒê³„ì¢Œ í™˜ë¶ˆì„ ìœ„í•´ì„œëŠ” PGì‚¬ **ê°€ìƒê³„ì¢Œ íŠ¹ì•½ì„œë¹„ìŠ¤**ì— ê°€ì…ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

{% hint style="info" %}
**ê°€ìƒê³„ì¢Œ íŠ¹ì•½ì„œë¹„ìŠ¤ì— ê°€ì…í•´ì•¼ í•˜ëŠ” ì´ìœ **

ì‹ ìš©ì¹´ë“œì™€ëŠ” ë‹¬ë¦¬ ê°€ìƒê³„ì¢Œì˜ ê²½ìš° ê²°ì œ/í™˜ë¶ˆì— ëŒ€í•œ ìˆ˜ìˆ˜ë£ŒëŠ” í™˜ë¶ˆëŒ€ìƒì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.ì˜ˆë¥¼ ë“¤ì–´ 10,000ì› ê²°ì œê±´ì— ëŒ€í•´ì„œ ê°€ë§¹ì ì€

* ê²°ì œ ì‹œ, 9,700ì›(10,000ì› - ê°€ìƒê³„ì¢Œ ë°œí–‰ ìˆ˜ìˆ˜ë£Œ 300ì›)ì„ PGì‚¬ë¡œë¶€í„° ì •ì‚°ë°›ìŠµë‹ˆë‹¤.
* í™˜ë¶ˆ ì‹œ, 10,300ì›(í™˜ë¶ˆë˜ì–´ì•¼í•  10,000ì› + í™˜ë¶ˆ ê³„ì¢Œë¡œì˜ ì†¡ê¸ˆ ìˆ˜ìˆ˜ë£Œ 300ì›)ì„ PGì‚¬ë¡œ ì§€ë¶ˆí•©ë‹ˆë‹¤.

PGì‚¬ëŠ” ì´ëŸ° ê³¼ì •ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” í˜¼ë€ì„ ë¯¸ì—°ì— ë°©ì§€í•˜ê³ ì **ê°€ìƒê³„ì¢Œ íŠ¹ì•½ì„œë¹„ìŠ¤ì— ê°€ì…í•œ ê°€ë§¹ì ì— í•œí•´ì„œë§Œ ê°€ìƒê³„ì¢Œ í™˜ë¶ˆì„ ì œê³µ**í•˜ê³  ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ê°€ìƒê³„ì¢Œì˜ ê²½ìš° ë‹¨ë°©í–¥ ê²°ì œìˆ˜ë‹¨ì´ì—¬ì„œ í™˜ë¶ˆ ëŒ€ìƒì„ ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ í™˜ë¶ˆ ê¸ˆì•¡ ì™¸ì— ë‹¤ìŒì˜ í™˜ë¶ˆ ìˆ˜ë ¹ê³„ì¢Œ ì •ë³´ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.

* `refund_holder`: í™˜ë¶ˆ ìˆ˜ë ¹ê³„ì¢Œ ì˜ˆê¸ˆì£¼
* `refund_account`: í™œë¶ˆ ìˆ˜ë ¹ê³„ì¢Œ ë²ˆí˜¸
* `refund_bank`: í™˜ë¶ˆ ìˆ˜ë ¹ê³„ì¢Œ ì€í–‰ì½”ë“œ

{% hint style="info" %}
**ê°€ìƒê³„ì¢Œ ì€í–‰ì½”ë“œëŠ” PGì‚¬ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤**

&#x20;**** `ì€í–‰ì½”ë“œëŠ”`ê°™ì€ ì€í–‰ì´ë”ë¼ë„ PGì‚¬ì— ë”°ë¼ ìƒì´í•˜ë¯€ë¡œ [**ì€í–‰ì½”ë“œ**](../../tip/pg-1.md)í‘œì—ì„œ ì€í–‰ì½”ë“œë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”
{% endhint %}

#### ì•„ë˜ëŠ” ê°€ìƒê³„ì¢Œ í™˜ë¶ˆì„ ìš”ì²­í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.

{% code title="Node.js" %}
```javascript
/* ... ì¤‘ëµ ... */
  app.post('/payments/cancel', async (req, res, next) => {
    try {
      /* ì•¡ì„¸ìŠ¤ í† í°(access token) ë°œê¸‰ */
      /* ... ì¤‘ëµ ... */
      /* ê²°ì œì •ë³´ ì¡°íšŒ */
      const { body } = req;
      // í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ì£¼ë¬¸ë²ˆí˜¸, í™˜ë¶ˆì‚¬ìœ , í™˜ë¶ˆê¸ˆì•¡, ê°€ìƒê³„ì¢Œ ì •ë³´(ì˜ˆê¸ˆì£¼, ê³„ì¢Œë²ˆí˜¸, ì€í–‰ì½”ë“œ)
      const { merchant_uid, reason, cancel_request_amount, refund_holder, refund_bank, refund_account } = body; 
      Payments.find({ merchant_uid }, async function(err, payment) { 
        /* ... ì¤‘ëµ ... */
        const paymentData = payment[0]; // ì¡°íšŒëœ ê²°ì œì •ë³´
        // ì¡°íšŒí•œ ê²°ì œì •ë³´ë¡œë¶€í„° imp_uid, amount(ê²°ì œê¸ˆì•¡), cancel_amount(í™˜ë¶ˆëœ ì´ ê¸ˆì•¡) ì¶”ì¶œ
        const { imp_uid, amount, cancel_amount } = paymentData; 
        // í™˜ë¶ˆ ê°€ëŠ¥ ê¸ˆì•¡(= ê²°ì œê¸ˆì•¡ - í™˜ë¶ˆëœ ì´ ê¸ˆì•¡) ê³„ì‚°
        const cancelableAmount = amount - cancel_amount; 
        if (cancelableAmount <= 0) { // ì´ë¯¸ ì „ì•¡ í™˜ë¶ˆëœ ê²½ìš°
          return res.status(400).json({ message: "ì´ë¯¸ ì „ì•¡í™˜ë¶ˆëœ ì£¼ë¬¸ì…ë‹ˆë‹¤." });
        }
        ...
        /* ì•„ì„í¬íŠ¸ REST APIë¡œ ê²°ì œí™˜ë¶ˆ ìš”ì²­ */
        const getCancelData = await axios({
          url: "https://api.iamport.kr/payments/cancel",
          method: "post",
          headers: {
            "Content-Type": "application/json",
            "Authorization": access_token // ì•„ì„í¬íŠ¸ ì„œë²„ë¡œë¶€í„° ë°œê¸‰ë°›ì€ ì—‘ì„¸ìŠ¤ í† í°
          },
          data: {
            reason, // ê°€ë§¹ì  í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ì€ í™˜ë¶ˆì‚¬ìœ 
            imp_uid, // imp_uidë¥¼ í™˜ë¶ˆ `unique key`ë¡œ ì…ë ¥
            amount: cancel_request_amount, // ê°€ë§¹ì  í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ì€ í™˜ë¶ˆê¸ˆì•¡
            checksum: cancelableAmount, // [ê¶Œì¥] í™˜ë¶ˆ ê°€ëŠ¥ ê¸ˆì•¡ ì…ë ¥
            refund_holder, // [ê°€ìƒê³„ì¢Œ í™˜ë¶ˆì‹œ í•„ìˆ˜ì…ë ¥] í™˜ë¶ˆ ìˆ˜ë ¹ê³„ì¢Œ ì˜ˆê¸ˆì£¼
            refund_bank, // [ê°€ìƒê³„ì¢Œ í™˜ë¶ˆì‹œ í•„ìˆ˜ì…ë ¥] í™˜ë¶ˆ ìˆ˜ë ¹ê³„ì¢Œ ì€í–‰ì½”ë“œ(ex. KGì´ë‹ˆì‹œìŠ¤ì˜ ê²½ìš° ì‹ í•œì€í–‰ì€ 88ë²ˆ)
            refund_account // [ê°€ìƒê³„ì¢Œ í™˜ë¶ˆì‹œ í•„ìˆ˜ì…ë ¥] í™˜ë¶ˆ ìˆ˜ë ¹ê³„ì¢Œ ë²ˆí˜¸
          }
        });
        const { response } = getCancelData.data; // í™˜ë¶ˆ ê²°ê³¼
        /* í™˜ë¶ˆ ê²°ê³¼ ë™ê¸°í™” */
        ...
      });
    } catch (error) {
      res.status(400).send(error);
    }
  });
```
{% endcode %}

ë‹¤ìŒê³¼ ê°™ì´ ê°€ìƒê³„ì¢Œ í™˜ë¶ˆì„ ìš”ì²­í•˜ì—¬ ì„±ê³µí•˜ë©´ PGì‚¬ ë‹´ë‹¹ìê°€ ë‹¤ìŒë‚  í•´ë‹¹ ê³„ì¢Œë¡œ í™˜ë¶ˆ ê¸ˆì•¡ì„ ì…ê¸ˆí•©ë‹ˆë‹¤. ì´ëŠ” í†µìƒì ìœ¼ë¡œ ì˜ì—½ì¼ ê¸°ì¤€ í•˜ë£¨ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤.

![ê°€ìƒê²Œì¢Œ í™˜ë¶ˆ FLOW](../../.gitbook/assets/vbank-refund-process.png)
